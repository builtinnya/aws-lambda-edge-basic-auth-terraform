"use strict";function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,r){if(e){if("string"==typeof e)return _arrayLikeToArray(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?_arrayLikeToArray(e,r):void 0}}function _arrayLikeToArray(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,a=new Array(r);t<r;t++)a[t]=e[t];return a}function _iterableToArrayLimit(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,o,n,s,i=[],l=!0,u=!1;try{if(n=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;l=!1}else for(;!(l=(a=n.call(t)).done)&&(i.push(a.value),i.length!==r);l=!0);}catch(e){u=!0,o=e}finally{try{if(!l&&null!=t.return&&(s=t.return(),Object(s)!==s))return}finally{if(u)throw o}}return i}}function _arrayWithHoles(e){if(Array.isArray(e))return e}var crypto=require("crypto");exports.handler=function(e,r,t){var a=e.Records[0].cf.request,o=a.headers,n=o.authorization&&o.authorization[0].value;if(n){var s=n.split(" ")[1],i=_slicedToArray(Buffer.from(s,"base64").toString("utf-8").split(":"),2),l=i[0],u=i[1];console.log("authUser: "+l),console.log("authPass: "+u);var c=crypto.createHash("sha256").update(u).digest("base64"),y=crypto.createHash("sha256").update(l).digest("base64"),h=process.env.BASIC_AUTH_HASHED_PASS,d=process.env.BASIC_AUTH_HASHED_USER;if(console.log("expectedPasswordHash: "+h),console.log("expectedUsernameHash: "+d),console.log("hashedPass: "+c),console.log("hashedUser: "+y),y===d&&c===h&&n)t(null,a);else{t(null,{status:"401",statusDescription:"Unauthorized",body:"Unauthorized",headers:{"www-authenticate":[{key:"WWW-Authenticate",value:"Basic"}]}})}}else{t(null,{status:"401",statusDescription:"Unauthorized",body:"Unauthorized",headers:{"www-authenticate":[{key:"WWW-Authenticate",value:"Basic"}]}})}};